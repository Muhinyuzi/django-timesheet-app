{% extends "timesheet/base.html" %}
{% block content %}

<h2>Feuille de temps - {{ timesheet.employee.name }}</h2>
<p>Semaine : {{ timesheet.week_start }} → {{ timesheet.week_end }}</p>

<form method="post">
  {% csrf_token %}
  {{ formset.management_form }}

  <table>
    <tr>
      <th>Jour</th>
      <th>Arrivée matin</th>
      <th>Départ dîner</th>
      <th>Retour dîner</th>
      <th>Arrivée soir</th>
      <th>Départ soir</th>
      <th>Total (h)</th>
    </tr>

    {% for form in formset %}
    <tr>
      <td>
        <div class="field">
          <strong>{{ form.instance.get_day_display }}</strong>

          {% if form.errors %}
            <div class="err">
              {% for field, errors in form.errors.items %}
                {% for e in errors %}
                  <div>{{ e }}</div>
                {% endfor %}
              {% endfor %}
            </div>
          {% endif %}
        </div>

        {# champ hidden id doit être dans un td #}
        <div style="display:none">{{ form.id }}</div>
      </td>

      <td>{{ form.arrival_morning }}</td>
      <td>{{ form.lunch_departure }}</td>
      <td>{{ form.lunch_return }}</td>
      <td>{{ form.arrival_evening }}</td>
      <td>{{ form.departure_evening }}</td>

      <td style="text-align:right">{{ form.instance.total_hours }}</td>
    </tr>
    {% endfor %}
  </table>

  <br>
  <button type="submit">Enregistrer</button>
  <br><br>
  <a href="{% url 'timesheet:export_timesheet_excel' timesheet.pk %}">
      Exporter en Excel
  </a>
</form>

<h3>Total semaine : {{ timesheet.total_hours_decimal }} heures</h3>

<h3>Résumé</h3>

<table>
  <tr>
    <td><b>Heures accumulées</b></td>
    <td style="text-align:right">{{ total_hours }}</td>
  </tr>
  <tr>
    <td><b>Total de la paie</b></td>
    <td style="text-align:right">{{ total_pay }} $</td>
  </tr>
  <tr>
    <td><b>Heures en banque</b></td>
    <td style="text-align:right">{{ total_banked }}</td>
  </tr>
</table>

{% endblock %}